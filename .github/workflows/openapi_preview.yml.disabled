name: OpenAPI Preview\n\non:\n  pull_request:\n    paths:\n      - \'openapi/openapi.yaml\' # Trigger only if openapi.yaml in the openapi/ dir changes\n\njobs:\n  build-and-deploy-preview:\n    runs-on: ubuntu-latest\n    permissions:\n      pull-requests: write # To comment on the PR\n      contents: read       # To checkout the repository\n      id-token: write      # If using OIDC for AWS authentication (recommended)\n\n    steps:\n      - name: Checkout repository\n        uses: actions/checkout@v3\n\n      - name: Set up Node.js (for ReDocly CLI)\n        uses: actions/setup-node@v3\n        with:\n          node-version: \'18\' # Or your preferred LTS version\n\n      - name: Install ReDocly CLI\n        run: npm install -g @redocly/cli\n\n      - name: Build HTML documentation\n        run: redocly build-docs openapi/openapi.yaml -o openapi-preview.html\n\n      - name: Configure AWS credentials (OIDC - Recommended)\n        uses: aws-actions/configure-aws-credentials@v2 \n        with:\n          role-to-assume: arn:aws:iam::YOUR_AWS_ACCOUNT_ID:role/YOUR_GITHUB_ACTIONS_S3_DEPLOY_ROLE # Replace with your IAM role\n          aws-region: YOUR_AWS_REGION # e.g., us-east-1\n\n      # Alternative: Configure AWS credentials (Access Keys - Less Secure)\n      # - name: Configure AWS credentials (Access Keys)\n      #   uses: aws-actions/configure-aws-credentials@v2\n      #   with:\n      #     aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}\n      #     aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}\n      #     aws-region: YOUR_AWS_REGION\n\n      - name: Upload HTML to S3\n        id: s3_upload\n        run: |\n          PR_NUMBER=$(echo \"${{ github.event.pull_request.number }}\")\n          S3_PATH=\"s3://YOUR_S3_BUCKET_NAME/openapi-previews/pr-${PR_NUMBER}/openapi-preview.html\"\n          aws s3 cp openapi-preview.html \"${S3_PATH}\" --acl public-read # Or adjust ACL as needed\n          echo \"PREVIEW_URL=https://YOUR_S3_BUCKET_NAME.s3.YOUR_AWS_REGION.amazonaws.com/openapi-previews/pr-${PR_NUMBER}/openapi-preview.html\" >> $GITHUB_OUTPUT\n        # Replace YOUR_S3_BUCKET_NAME and YOUR_AWS_REGION\n        # Note: The S3 URL format can vary based on your S3 settings (e.g., path-style vs virtual-hosted). Adjust accordingly.\n\n      - name: Comment on PR with Preview URL\n        uses: actions/github-script@v6\n        with:\n          github-token: ${{ secrets.GITHUB_TOKEN }}\n          script: |\n            const previewUrl = \"${{ steps.s3_upload.outputs.PREVIEW_URL }}\";\n            const issue_number = context.issue.number;\n            const commentBody = `\n              OpenAPI documentation preview for this PR:\n              [View Preview](${previewUrl})\n\n              *Note: This preview is automatically generated whenever \`openapi/openapi.yaml\` is updated.*\n            `;\n\n            // Check if a comment with a similar header already exists\n            const { data: comments } = await github.rest.issues.listComments({\n              owner: context.repo.owner,\n              repo: context.repo.repo,\n              issue_number: issue_number,\n            });\n\n            const botCommentMarker = \"OpenAPI documentation preview for this PR:\";\n            const existingComment = comments.find(comment => comment.user.login === \'github-actions[bot]\' && comment.body.includes(botCommentMarker));\n\n            if (existingComment) {\n              // Update existing comment\n              await github.rest.issues.updateComment({\n                owner: context.repo.owner,\n                repo: context.repo.repo,\n                comment_id: existingComment.id,\n                body: commentBody,\n              });\n              console.log(`Updated existing comment on PR #${issue_number}.`);\n            } else {\n              // Create new comment\n              await github.rest.issues.createComment({\n                owner: context.repo.owner,\n                repo: context.repo.repo,\n                issue_number: issue_number,\n                body: commentBody,\n              });\n              console.log(`Created new comment on PR #${issue_number}.`);\n            }\n 